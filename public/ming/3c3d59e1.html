<!DOCTYPE html><html class="theme-next gemini" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="cdn,oss,http/https,阿里云,"><link rel="alternate" href="/atom.xml" title="ming" type="application/atom+xml"><meta name="description" content="之前一直想搭建一个博客 但是一直没找到便宜 并且访问速度快的方案 前几种方案1:git pages + cdn国内访问速度简直吃屎 不知道 同行是如何忍受的 cdn从源站拉取资源的时候 慢到无法忍受2:coding pages+cdn不想用 coding pages 还不如直接用git pages3: 购买vps或者静态托管服务器博客初期完全用不起 太特么贵了 穷吊 用不起综上所述 我需要的博客大"><meta name="keywords" content="cdn,oss,http&#x2F;https,阿里云"><meta property="og:type" content="article"><meta property="og:title" content="使用阿里云的oss+cdn搭建高速访问的静态博客"><meta property="og:url" content="http://www.xujiuming.com/ming/3c3d59e1.html"><meta property="og:site_name" content="ming"><meta property="og:description" content="之前一直想搭建一个博客 但是一直没找到便宜 并且访问速度快的方案 前几种方案1:git pages + cdn国内访问速度简直吃屎 不知道 同行是如何忍受的 cdn从源站拉取资源的时候 慢到无法忍受2:coding pages+cdn不想用 coding pages 还不如直接用git pages3: 购买vps或者静态托管服务器博客初期完全用不起 太特么贵了 穷吊 用不起综上所述 我需要的博客大"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2018-08-17T08:10:03.923Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="使用阿里云的oss+cdn搭建高速访问的静态博客"><meta name="twitter:description" content="之前一直想搭建一个博客 但是一直没找到便宜 并且访问速度快的方案 前几种方案1:git pages + cdn国内访问速度简直吃屎 不知道 同行是如何忍受的 cdn从源站拉取资源的时候 慢到无法忍受2:coding pages+cdn不想用 coding pages 还不如直接用git pages3: 购买vps或者静态托管服务器博客初期完全用不起 太特么贵了 穷吊 用不起综上所述 我需要的博客大"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"输入关键字",hits_empty:"无法找到: ${query}",hits_stats:"${hits} 条相关记录 共耗时：${time} ms"}}}</script><link rel="canonical" href="http://www.xujiuming.com/ming/3c3d59e1.html"><title>使用阿里云的oss+cdn搭建高速访问的静态博客 | ming</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?2791c152c4e0928cfc5e4b8fcc6a6ff8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">ming</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">ming</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/index.html" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/index.html" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/index.html" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-about"><a href="/about/index.html" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/index.html" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>时间轴</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.xujiuming.com/ming/3c3d59e1.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ming"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ming"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">使用阿里云的oss+cdn搭建高速访问的静态博客</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-09T13:42:02+08:00">2018-02-09 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/骚想法/" itemprop="url" rel="index"><span itemprop="name">骚想法</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/ming/3c3d59e1.html#comments" itemprop="discussionUrl"><span class="post-comments-count gitment-comments-count" data-xid="/ming/3c3d59e1.html" itemprop="commentsCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>之前一直想搭建一个博客 但是一直没找到便宜 并且访问速度快的方案 前几种方案<br>1:git pages + cdn<br>国内访问速度简直吃屎 不知道 同行是如何忍受的 cdn从源站拉取资源的时候 慢到无法忍受<br>2:coding pages+cdn<br>不想用 coding pages 还不如直接用git pages<br>3: 购买vps或者静态托管服务器<br>博客初期完全用不起 太特么贵了 穷吊 用不起</p><p>综上所述 我需要的博客大致需要<br>1:源站访问速度快<br>2:cdn 好用<br>3:域名<br>4:https http2访问<br>5:价格相对便宜<br>6:管理相对方便<br>7:增加ca证书方便</p><p>最终选择方案<br>全部使用阿里云的相关资源<br>域名：万网<br>cdn:阿里云 cdn<br>源站:使用阿里云的oss对象存储<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">oss  原本只是 阿里云的一个放文件的一个功能 后来他支持设定首页 就可以用来托管静态页面 </span><br><span class="line">速度不用说 肯定快 而且支持 https</span><br></pre></td></tr></table></figure><p></p>
<p>ca证书:阿里云 ca免费赛门铁克证书<br>静态博客:hexo + next主题</p>
<p>其实这些主要是选择  具体如何使用 直接操作阿里云控制台就是的 没啥难度 </p>
<p>遇到的麻烦的点:<br>1: oss 存储hexo生成的静态资源 路由问题<br>由于oss 里面 文件夹也是可访问的一种资源 这就导致 hexo初始生成的路由 例如/tags/ming/  这个时候他访问的是oss里面的/tags/ming/ 文件夹 然后是空白<br>解决办法: 修改站点配置_config.yaml 中permalink参数<br>我是用abbrlink 来重写url了 如果不用 就是在hexo的permalink中 后面加上.html 即可<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 使用abbrlink 来重写固定url  https://segmentfault.com/a/1190000005799711</span><br><span class="line">permalink: ming/:abbrlink.html</span><br><span class="line">permalink_defaults:</span><br></pre></td></tr></table></figure><p></p>
<p>标签、归档、分页相关路由   调整<br>修改 当前目录下node_modules/hexo/lib/plugins/helper/index.js 中关于 标签、归档、分页相关的插件<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">module.exports = function (ctx) &#123;</span><br><span class="line">。。。</span><br><span class="line"></span><br><span class="line">//重写 归档 js  增加index.html 路径 配合 oss 访问</span><br><span class="line">//    helper.register(&apos;list_categories&apos;, require(&apos;./list_categories&apos;));</span><br><span class="line">    helper.register(&apos;list_categories&apos;, require(&apos;./ming_list_categories&apos;));</span><br><span class="line">    </span><br><span class="line">。。。   </span><br><span class="line"></span><br><span class="line">//重写分页相关地址 配合oss</span><br><span class="line">//    helper.register(&apos;paginator&apos;, require(&apos;./paginator&apos;));</span><br><span class="line">    helper.register(&apos;paginator&apos;, require(&apos;./ming_paginator&apos;));</span><br><span class="line">    </span><br><span class="line">。。。</span><br><span class="line"></span><br><span class="line">//  var tagcloud = require(&apos;./tagcloud&apos;);</span><br><span class="line">//  helper.register(&apos;tagcloud&apos;, tagcloud);</span><br><span class="line">//  helper.register(&apos;tag_cloud&apos;, tagcloud);</span><br><span class="line">    //引入 自定义 tag cloud 标签  修改生成路径的函数 适应oss</span><br><span class="line">    var ming_tag = require(&apos;./ming_tag&apos;)</span><br><span class="line">    helper.register(&apos;tagcloud&apos;, ming_tag);</span><br><span class="line">    helper.register(&apos;tag_cloud&apos;, ming_tag);</span><br><span class="line">。。。</span><br></pre></td></tr></table></figure><p></p>
<p>在index.js目录下<br>新增下面三个文件 </p>
<p>归档插件的实现<br>新增 ming_list_categories.js文件<br>复制如下内容进去<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">function listCategoriesHelper(categories, options) &#123;</span><br><span class="line">  if (!options &amp;&amp; (!categories || !categories.hasOwnProperty(&apos;length&apos;))) &#123;</span><br><span class="line">    options = categories;</span><br><span class="line">    categories = this.site.categories;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (!categories || !categories.length) return &apos;&apos;;</span><br><span class="line">  options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  var style = options.hasOwnProperty(&apos;style&apos;) ? options.style : &apos;list&apos;;</span><br><span class="line">  var showCount = options.hasOwnProperty(&apos;show_count&apos;) ? options.show_count : true;</span><br><span class="line">  var className = options.class || &apos;category&apos;;</span><br><span class="line">  var depth = options.depth ? parseInt(options.depth, 10) : 0;</span><br><span class="line">  var orderby = options.orderby || &apos;name&apos;;</span><br><span class="line">  var order = options.order || 1;</span><br><span class="line">  var transform = options.transform;</span><br><span class="line">  var separator = options.hasOwnProperty(&apos;separator&apos;) ? options.separator : &apos;, &apos;;</span><br><span class="line">  var showCurrent = options.show_current || false;</span><br><span class="line">    // 添加 /index.html 配合oss 访问</span><br><span class="line">    //var suffix = options.suffix || &apos;&apos;;</span><br><span class="line">  var suffix = &quot;index.html&quot;;</span><br><span class="line">  var childrenIndicator = options.hasOwnProperty(&apos;children_indicator&apos;) ? options.children_indicator : false;</span><br><span class="line">  var result = &apos;&apos;;</span><br><span class="line">  var self = this;</span><br><span class="line"></span><br><span class="line">  function prepareQuery(parent) &#123;</span><br><span class="line">    var query = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    if (parent) &#123;</span><br><span class="line">      query.parent = parent;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      query.parent = &#123;$exists: false&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return categories.find(query).sort(orderby, order).filter(function(cat) &#123;</span><br><span class="line">      return cat.length;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function hierarchicalList(level, parent) &#123;</span><br><span class="line">    var result = &apos;&apos;;</span><br><span class="line"></span><br><span class="line">    prepareQuery(parent).forEach(function(cat, i) &#123;</span><br><span class="line">      var child;</span><br><span class="line">      if (!depth || level + 1 &lt; depth) &#123;</span><br><span class="line">        child = hierarchicalList(level + 1, cat._id);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      var isCurrent = false;</span><br><span class="line">      if (showCurrent &amp;&amp; self.page) &#123;</span><br><span class="line">        for (var j = 0; j &lt; cat.length; j++) &#123;</span><br><span class="line">          var post = cat.posts.data[j];</span><br><span class="line">          if (post &amp;&amp; post._id === self.page._id) &#123;</span><br><span class="line">            isCurrent = true;</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // special case: category page</span><br><span class="line">        if (!isCurrent &amp;&amp; self.page.base) &#123;</span><br><span class="line">          if (self.page.base.indexOf(cat.path) === 0) &#123;</span><br><span class="line">            isCurrent = true;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      var additionalClassName = &apos;&apos;;</span><br><span class="line">      if (child &amp;&amp; childrenIndicator) &#123;</span><br><span class="line">        additionalClassName = &apos; &apos; + childrenIndicator;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result += &apos;&lt;li class=&quot;&apos; + className + &apos;-list-item&apos; + additionalClassName + &apos;&quot;&gt;&apos;;</span><br><span class="line">      result += &apos;&lt;a class=&quot;&apos; + className + &apos;-list-link&apos; + (isCurrent ? &apos; current&apos; : &apos;&apos;) + &apos;&quot; href=&quot;&apos; + self.url_for(cat.path) + suffix + &apos;&quot;&gt;&apos;;</span><br><span class="line">      result += transform ? transform(cat.name) : cat.name;</span><br><span class="line">      result += &apos;&lt;/a&gt;&apos;;</span><br><span class="line"></span><br><span class="line">      if (showCount) &#123;</span><br><span class="line">        result += &apos;&lt;span class=&quot;&apos; + className + &apos;-list-count&quot;&gt;&apos; + cat.length + &apos;&lt;/span&gt;&apos;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (child) &#123;</span><br><span class="line">        result += &apos;&lt;ul class=&quot;&apos; + className + &apos;-list-child&quot;&gt;&apos; + child + &apos;&lt;/ul&gt;&apos;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result += &apos;&lt;/li&gt;&apos;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function flatList(level, parent) &#123;</span><br><span class="line">    var result = &apos;&apos;;</span><br><span class="line"></span><br><span class="line">    prepareQuery(parent).forEach(function(cat, i) &#123;</span><br><span class="line">      if (i || level) result += separator;</span><br><span class="line"></span><br><span class="line">      result += &apos;&lt;a class=&quot;&apos; + className + &apos;-link&quot; href=&quot;&apos; + self.url_for(cat.path) + suffix + &apos;&quot;&gt;&apos;;</span><br><span class="line">      result += transform ? transform(cat.name) : cat.name;</span><br><span class="line"></span><br><span class="line">      if (showCount) &#123;</span><br><span class="line">        result += &apos;&lt;span class=&quot;&apos; + className + &apos;-count&quot;&gt;&apos; + cat.length + &apos;&lt;/span&gt;&apos;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      result += &apos;&lt;/a&gt;&apos;;</span><br><span class="line"></span><br><span class="line">      if (!depth || level + 1 &lt; depth) &#123;</span><br><span class="line">        result += flatList(level + 1, cat._id);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (style === &apos;list&apos;) &#123;</span><br><span class="line">    result += &apos;&lt;ul class=&quot;&apos; + className + &apos;-list&quot;&gt;&apos; + hierarchicalList(0) + &apos;&lt;/ul&gt;&apos;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    result += flatList(0);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = listCategoriesHelper;</span><br></pre></td></tr></table></figure><p></p>
<p>分页插件的实现<br>新增 ming_paginator.js文件<br>复制如下内容进去<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">function paginatorHelper(options) &#123;</span><br><span class="line">  options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  var current = options.current || this.page.current || 0;</span><br><span class="line">  var total = options.total || this.page.total || 1;</span><br><span class="line">  var endSize = options.hasOwnProperty(&apos;end_size&apos;) ? +options.end_size : 1;</span><br><span class="line">  var midSize = options.hasOwnProperty(&apos;mid_size&apos;) ? +options.mid_size : 2;</span><br><span class="line">  var space = options.hasOwnProperty(&apos;space&apos;) ? options.space : &apos;&amp;hellip;&apos;;</span><br><span class="line">  var base = options.base || this.page.base || &apos;&apos;;</span><br><span class="line">  var format = options.format || this.config.pagination_dir + &apos;/%d/&apos;;</span><br><span class="line">  var prevText = options.prev_text || &apos;Prev&apos;;</span><br><span class="line">  var nextText = options.next_text || &apos;Next&apos;;</span><br><span class="line">  var prevNext = options.hasOwnProperty(&apos;prev_next&apos;) ? options.prev_next : true;</span><br><span class="line">  var transform = options.transform;</span><br><span class="line">  var self = this;</span><br><span class="line">  var result = &apos;&apos;;</span><br><span class="line">  var i;</span><br><span class="line">  //配合 oss 使用index.html</span><br><span class="line">  var suffix = &quot;index.html&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    if (!current) return &apos;&apos;;</span><br><span class="line"></span><br><span class="line">  var currentPage = &apos;&lt;span class=&quot;page-number current&quot;&gt;&apos; +</span><br><span class="line">    (transform ? transform(current) : current) +</span><br><span class="line">    &apos;&lt;/span&gt;&apos;;</span><br><span class="line"></span><br><span class="line">  function link(i) &#123;</span><br><span class="line">    return self.url_for(i === 1 ? base : base + format.replace(&apos;%d&apos;, i));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function pageLink(i) &#123;</span><br><span class="line">    return &apos;&lt;a class=&quot;page-number&quot; href=&quot;&apos; + link(i) + suffix +&apos;&quot;&gt;&apos; +</span><br><span class="line">      (transform ? transform(i) : i) +</span><br><span class="line">      &apos;&lt;/a&gt;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Display the link to the previous page</span><br><span class="line">  if (prevNext &amp;&amp; current &gt; 1) &#123;</span><br><span class="line">    result += &apos;&lt;a class=&quot;extend prev&quot; rel=&quot;prev&quot; href=&quot;&apos; + link(current - 1) + suffix +&apos;&quot;&gt;&apos; + prevText + &apos;&lt;/a&gt;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (options.show_all) &#123;</span><br><span class="line">    // Display pages on the left side of the current page</span><br><span class="line">    for (i = 1; i &lt; current; i++) &#123;</span><br><span class="line">      result += pageLink(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Display the current page</span><br><span class="line">    result += currentPage;</span><br><span class="line"></span><br><span class="line">    // Display pages on the right side of the current page</span><br><span class="line">    for (i = current + 1; i &lt;= total; i++) &#123;</span><br><span class="line">      result += pageLink(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // It&apos;s too complicated. May need refactor.</span><br><span class="line">    var leftEnd = current &lt;= endSize ? current - 1 : endSize;</span><br><span class="line">    var rightEnd = total - current &lt;= endSize ? current + 1 : total - endSize + 1;</span><br><span class="line">    var leftMid = current - midSize &lt;= endSize ? leftEnd + 1 : current - midSize;</span><br><span class="line">    var rightMid = current + midSize + endSize &gt; total ? rightEnd - 1 : current + midSize;</span><br><span class="line">    var spaceHtml = &apos;&lt;span class=&quot;space&quot;&gt;&apos; + space + &apos;&lt;/span&gt;&apos;;</span><br><span class="line"></span><br><span class="line">    // Display pages on the left edge</span><br><span class="line">    for (i = 1; i &lt;= leftEnd; i++) &#123;</span><br><span class="line">      result += pageLink(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Display spaces between edges and middle pages</span><br><span class="line">    if (space &amp;&amp; current - endSize - midSize &gt; 1) &#123;</span><br><span class="line">      result += spaceHtml;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Display left middle pages</span><br><span class="line">    if (leftMid &gt; leftEnd) &#123;</span><br><span class="line">      for (i = leftMid; i &lt; current; i++) &#123;</span><br><span class="line">        result += pageLink(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Display the current page</span><br><span class="line">    result += currentPage;</span><br><span class="line"></span><br><span class="line">    // Display right middle pages</span><br><span class="line">    if (rightMid &lt; rightEnd) &#123;</span><br><span class="line">      for (i = current + 1; i &lt;= rightMid; i++) &#123;</span><br><span class="line">        result += pageLink(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Display spaces between edges and middle pages</span><br><span class="line">    if (space &amp;&amp; total - endSize - midSize &gt; current) &#123;</span><br><span class="line">      result += spaceHtml;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Dispaly pages on the right edge</span><br><span class="line">    for (i = rightEnd; i &lt;= total; i++) &#123;</span><br><span class="line">      result += pageLink(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Display the link to the next page</span><br><span class="line">  if (prevNext &amp;&amp; current &lt; total) &#123;</span><br><span class="line">    result += &apos;&lt;a class=&quot;extend next&quot; rel=&quot;next&quot; href=&quot;&apos; + link(current + 1) + suffix+ &apos;&quot;&gt;&apos; + nextText + &apos;&lt;/a&gt;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = paginatorHelper;</span><br></pre></td></tr></table></figure><p></p>
<p>标签插件的实现<br>新增 ming_tag.js文件<br>复制如下内容进去<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">// https://github.com/imathis/hsl-picker/blob/master/assets/javascripts/modules/color.coffee</span><br><span class="line">var rHex3 = /^#([0-9a-f]&#123;3&#125;)$/;</span><br><span class="line">var rHex6 = /^#([0-9a-f]&#123;6&#125;)$/;</span><br><span class="line">var rRGB = /^rgba?\(\s*(\d&#123;1,3&#125;)\s*,\s*(\d&#123;1,3&#125;)\s*,\s*(\d&#123;1,3&#125;)\s*,?\s*(0?\.?\d+)?\s*\)$/;</span><br><span class="line">var rHSL = /^hsla?\(\s*(\d&#123;1,3&#125;)\s*,\s*(\d&#123;1,3&#125;)%\s*,\s*(\d&#123;1,3&#125;)%\s*,?\s*(0?\.?\d+)?\s*\)$/;</span><br><span class="line"></span><br><span class="line">// http://www.w3.org/TR/css3-color/#svg-color</span><br><span class="line">var colorNames = &#123;</span><br><span class="line">    aliceblue: &#123;r: 240, g: 248, b: 255, a: 1&#125;,</span><br><span class="line">    antiquewhite: &#123;r: 250, g: 235, b: 215, a: 1&#125;,</span><br><span class="line">    aqua: &#123;r: 0, g: 255, b: 255, a: 1&#125;,</span><br><span class="line">    aquamarine: &#123;r: 127, g: 255, b: 212, a: 1&#125;,</span><br><span class="line">    azure: &#123;r: 240, g: 255, b: 255, a: 1&#125;,</span><br><span class="line">    beige: &#123;r: 245, g: 245, b: 220, a: 1&#125;,</span><br><span class="line">    bisque: &#123;r: 255, g: 228, b: 196, a: 1&#125;,</span><br><span class="line">    black: &#123;r: 0, g: 0, b: 0, a: 1&#125;,</span><br><span class="line">    blanchedalmond: &#123;r: 255, g: 235, b: 205, a: 1&#125;,</span><br><span class="line">    blue: &#123;r: 0, g: 0, b: 255, a: 1&#125;,</span><br><span class="line">    blueviolet: &#123;r: 138, g: 43, b: 226, a: 1&#125;,</span><br><span class="line">    brown: &#123;r: 165, g: 42, b: 42, a: 1&#125;,</span><br><span class="line">    burlywood: &#123;r: 222, g: 184, b: 135, a: 1&#125;,</span><br><span class="line">    cadetblue: &#123;r: 95, g: 158, b: 160, a: 1&#125;,</span><br><span class="line">    chartreuse: &#123;r: 127, g: 255, b: 0, a: 1&#125;,</span><br><span class="line">    chocolate: &#123;r: 210, g: 105, b: 30, a: 1&#125;,</span><br><span class="line">    coral: &#123;r: 255, g: 127, b: 80, a: 1&#125;,</span><br><span class="line">    cornflowerblue: &#123;r: 100, g: 149, b: 237, a: 1&#125;,</span><br><span class="line">    cornsilk: &#123;r: 255, g: 248, b: 220, a: 1&#125;,</span><br><span class="line">    crimson: &#123;r: 220, g: 20, b: 60, a: 1&#125;,</span><br><span class="line">    cyan: &#123;r: 0, g: 255, b: 255, a: 1&#125;,</span><br><span class="line">    darkblue: &#123;r: 0, g: 0, b: 139, a: 1&#125;,</span><br><span class="line">    darkcyan: &#123;r: 0, g: 139, b: 139, a: 1&#125;,</span><br><span class="line">    darkgoldenrod: &#123;r: 184, g: 134, b: 11, a: 1&#125;,</span><br><span class="line">    darkgray: &#123;r: 169, g: 169, b: 169, a: 1&#125;,</span><br><span class="line">    darkgreen: &#123;r: 0, g: 100, b: 0, a: 1&#125;,</span><br><span class="line">    darkgrey: &#123;r: 169, g: 169, b: 169, a: 1&#125;,</span><br><span class="line">    darkkhaki: &#123;r: 189, g: 183, b: 107, a: 1&#125;,</span><br><span class="line">    darkmagenta: &#123;r: 139, g: 0, b: 139, a: 1&#125;,</span><br><span class="line">    darkolivegreen: &#123;r: 85, g: 107, b: 47, a: 1&#125;,</span><br><span class="line">    darkorange: &#123;r: 255, g: 140, b: 0, a: 1&#125;,</span><br><span class="line">    darkorchid: &#123;r: 153, g: 50, b: 204, a: 1&#125;,</span><br><span class="line">    darkred: &#123;r: 139, g: 0, b: 0, a: 1&#125;,</span><br><span class="line">    darksalmon: &#123;r: 233, g: 150, b: 122, a: 1&#125;,</span><br><span class="line">    darkseagreen: &#123;r: 143, g: 188, b: 143, a: 1&#125;,</span><br><span class="line">    darkslateblue: &#123;r: 72, g: 61, b: 139, a: 1&#125;,</span><br><span class="line">    darkslategray: &#123;r: 47, g: 79, b: 79, a: 1&#125;,</span><br><span class="line">    darkslategrey: &#123;r: 47, g: 79, b: 79, a: 1&#125;,</span><br><span class="line">    darkturquoise: &#123;r: 0, g: 206, b: 209, a: 1&#125;,</span><br><span class="line">    darkviolet: &#123;r: 148, g: 0, b: 211, a: 1&#125;,</span><br><span class="line">    deeppink: &#123;r: 255, g: 20, b: 147, a: 1&#125;,</span><br><span class="line">    deepskyblue: &#123;r: 0, g: 191, b: 255, a: 1&#125;,</span><br><span class="line">    dimgray: &#123;r: 105, g: 105, b: 105, a: 1&#125;,</span><br><span class="line">    dimgrey: &#123;r: 105, g: 105, b: 105, a: 1&#125;,</span><br><span class="line">    dodgerblue: &#123;r: 30, g: 144, b: 255, a: 1&#125;,</span><br><span class="line">    firebrick: &#123;r: 178, g: 34, b: 34, a: 1&#125;,</span><br><span class="line">    floralwhite: &#123;r: 255, g: 250, b: 240, a: 1&#125;,</span><br><span class="line">    forestgreen: &#123;r: 34, g: 139, b: 34, a: 1&#125;,</span><br><span class="line">    fuchsia: &#123;r: 255, g: 0, b: 255, a: 1&#125;,</span><br><span class="line">    gainsboro: &#123;r: 220, g: 220, b: 220, a: 1&#125;,</span><br><span class="line">    ghostwhite: &#123;r: 248, g: 248, b: 255, a: 1&#125;,</span><br><span class="line">    gold: &#123;r: 255, g: 215, b: 0, a: 1&#125;,</span><br><span class="line">    goldenrod: &#123;r: 218, g: 165, b: 32, a: 1&#125;,</span><br><span class="line">    gray: &#123;r: 128, g: 128, b: 128, a: 1&#125;,</span><br><span class="line">    green: &#123;r: 0, g: 128, b: 0, a: 1&#125;,</span><br><span class="line">    greenyellow: &#123;r: 173, g: 255, b: 47, a: 1&#125;,</span><br><span class="line">    grey: &#123;r: 128, g: 128, b: 128, a: 1&#125;,</span><br><span class="line">    honeydew: &#123;r: 240, g: 255, b: 240, a: 1&#125;,</span><br><span class="line">    hotpink: &#123;r: 255, g: 105, b: 180, a: 1&#125;,</span><br><span class="line">    indianred: &#123;r: 205, g: 92, b: 92, a: 1&#125;,</span><br><span class="line">    indigo: &#123;r: 75, g: 0, b: 130, a: 1&#125;,</span><br><span class="line">    ivory: &#123;r: 255, g: 255, b: 240, a: 1&#125;,</span><br><span class="line">    khaki: &#123;r: 240, g: 230, b: 140, a: 1&#125;,</span><br><span class="line">    lavender: &#123;r: 230, g: 230, b: 250, a: 1&#125;,</span><br><span class="line">    lavenderblush: &#123;r: 255, g: 240, b: 245, a: 1&#125;,</span><br><span class="line">    lawngreen: &#123;r: 124, g: 252, b: 0, a: 1&#125;,</span><br><span class="line">    lemonchiffon: &#123;r: 255, g: 250, b: 205, a: 1&#125;,</span><br><span class="line">    lightblue: &#123;r: 173, g: 216, b: 230, a: 1&#125;,</span><br><span class="line">    lightcoral: &#123;r: 240, g: 128, b: 128, a: 1&#125;,</span><br><span class="line">    lightcyan: &#123;r: 224, g: 255, b: 255, a: 1&#125;,</span><br><span class="line">    lightgoldenrodyellow: &#123;r: 250, g: 250, b: 210, a: 1&#125;,</span><br><span class="line">    lightgray: &#123;r: 211, g: 211, b: 211, a: 1&#125;,</span><br><span class="line">    lightgreen: &#123;r: 144, g: 238, b: 144, a: 1&#125;,</span><br><span class="line">    lightgrey: &#123;r: 211, g: 211, b: 211, a: 1&#125;,</span><br><span class="line">    lightpink: &#123;r: 255, g: 182, b: 193, a: 1&#125;,</span><br><span class="line">    lightsalmon: &#123;r: 255, g: 160, b: 122, a: 1&#125;,</span><br><span class="line">    lightseagreen: &#123;r: 32, g: 178, b: 170, a: 1&#125;,</span><br><span class="line">    lightskyblue: &#123;r: 135, g: 206, b: 250, a: 1&#125;,</span><br><span class="line">    lightslategray: &#123;r: 119, g: 136, b: 153, a: 1&#125;,</span><br><span class="line">    lightslategrey: &#123;r: 119, g: 136, b: 153, a: 1&#125;,</span><br><span class="line">    lightsteelblue: &#123;r: 176, g: 196, b: 222, a: 1&#125;,</span><br><span class="line">    lightyellow: &#123;r: 255, g: 255, b: 224, a: 1&#125;,</span><br><span class="line">    lime: &#123;r: 0, g: 255, b: 0, a: 1&#125;,</span><br><span class="line">    limegreen: &#123;r: 50, g: 205, b: 50, a: 1&#125;,</span><br><span class="line">    linen: &#123;r: 250, g: 240, b: 230, a: 1&#125;,</span><br><span class="line">    magenta: &#123;r: 255, g: 0, b: 255, a: 1&#125;,</span><br><span class="line">    maroon: &#123;r: 128, g: 0, b: 0, a: 1&#125;,</span><br><span class="line">    mediumaquamarine: &#123;r: 102, g: 205, b: 170, a: 1&#125;,</span><br><span class="line">    mediumblue: &#123;r: 0, g: 0, b: 205, a: 1&#125;,</span><br><span class="line">    mediumorchid: &#123;r: 186, g: 85, b: 211, a: 1&#125;,</span><br><span class="line">    mediumpurple: &#123;r: 147, g: 112, b: 219, a: 1&#125;,</span><br><span class="line">    mediumseagreen: &#123;r: 60, g: 179, b: 113, a: 1&#125;,</span><br><span class="line">    mediumslateblue: &#123;r: 123, g: 104, b: 238, a: 1&#125;,</span><br><span class="line">    mediumspringgreen: &#123;r: 0, g: 250, b: 154, a: 1&#125;,</span><br><span class="line">    mediumturquoise: &#123;r: 72, g: 209, b: 204, a: 1&#125;,</span><br><span class="line">    mediumvioletred: &#123;r: 199, g: 21, b: 133, a: 1&#125;,</span><br><span class="line">    midnightblue: &#123;r: 25, g: 25, b: 112, a: 1&#125;,</span><br><span class="line">    mintcream: &#123;r: 245, g: 255, b: 250, a: 1&#125;,</span><br><span class="line">    mistyrose: &#123;r: 255, g: 228, b: 225, a: 1&#125;,</span><br><span class="line">    moccasin: &#123;r: 255, g: 228, b: 181, a: 1&#125;,</span><br><span class="line">    navajowhite: &#123;r: 255, g: 222, b: 173, a: 1&#125;,</span><br><span class="line">    navy: &#123;r: 0, g: 0, b: 128, a: 1&#125;,</span><br><span class="line">    oldlace: &#123;r: 253, g: 245, b: 230, a: 1&#125;,</span><br><span class="line">    olive: &#123;r: 128, g: 128, b: 0, a: 1&#125;,</span><br><span class="line">    olivedrab: &#123;r: 107, g: 142, b: 35, a: 1&#125;,</span><br><span class="line">    orange: &#123;r: 255, g: 165, b: 0, a: 1&#125;,</span><br><span class="line">    orangered: &#123;r: 255, g: 69, b: 0, a: 1&#125;,</span><br><span class="line">    orchid: &#123;r: 218, g: 112, b: 214, a: 1&#125;,</span><br><span class="line">    palegoldenrod: &#123;r: 238, g: 232, b: 170, a: 1&#125;,</span><br><span class="line">    palegreen: &#123;r: 152, g: 251, b: 152, a: 1&#125;,</span><br><span class="line">    paleturquoise: &#123;r: 175, g: 238, b: 238, a: 1&#125;,</span><br><span class="line">    palevioletred: &#123;r: 219, g: 112, b: 147, a: 1&#125;,</span><br><span class="line">    papayawhip: &#123;r: 255, g: 239, b: 213, a: 1&#125;,</span><br><span class="line">    peachpuff: &#123;r: 255, g: 218, b: 185, a: 1&#125;,</span><br><span class="line">    peru: &#123;r: 205, g: 133, b: 63, a: 1&#125;,</span><br><span class="line">    pink: &#123;r: 255, g: 192, b: 203, a: 1&#125;,</span><br><span class="line">    plum: &#123;r: 221, g: 160, b: 221, a: 1&#125;,</span><br><span class="line">    powderblue: &#123;r: 176, g: 224, b: 230, a: 1&#125;,</span><br><span class="line">    purple: &#123;r: 128, g: 0, b: 128, a: 1&#125;,</span><br><span class="line">    red: &#123;r: 255, g: 0, b: 0, a: 1&#125;,</span><br><span class="line">    rosybrown: &#123;r: 188, g: 143, b: 143, a: 1&#125;,</span><br><span class="line">    royalblue: &#123;r: 65, g: 105, b: 225, a: 1&#125;,</span><br><span class="line">    saddlebrown: &#123;r: 139, g: 69, b: 19, a: 1&#125;,</span><br><span class="line">    salmon: &#123;r: 250, g: 128, b: 114, a: 1&#125;,</span><br><span class="line">    sandybrown: &#123;r: 244, g: 164, b: 96, a: 1&#125;,</span><br><span class="line">    seagreen: &#123;r: 46, g: 139, b: 87, a: 1&#125;,</span><br><span class="line">    seashell: &#123;r: 255, g: 245, b: 238, a: 1&#125;,</span><br><span class="line">    sienna: &#123;r: 160, g: 82, b: 45, a: 1&#125;,</span><br><span class="line">    silver: &#123;r: 192, g: 192, b: 192, a: 1&#125;,</span><br><span class="line">    skyblue: &#123;r: 135, g: 206, b: 235, a: 1&#125;,</span><br><span class="line">    slateblue: &#123;r: 106, g: 90, b: 205, a: 1&#125;,</span><br><span class="line">    slategray: &#123;r: 112, g: 128, b: 144, a: 1&#125;,</span><br><span class="line">    slategrey: &#123;r: 112, g: 128, b: 144, a: 1&#125;,</span><br><span class="line">    snow: &#123;r: 255, g: 250, b: 250, a: 1&#125;,</span><br><span class="line">    springgreen: &#123;r: 0, g: 255, b: 127, a: 1&#125;,</span><br><span class="line">    steelblue: &#123;r: 70, g: 130, b: 180, a: 1&#125;,</span><br><span class="line">    tan: &#123;r: 210, g: 180, b: 140, a: 1&#125;,</span><br><span class="line">    teal: &#123;r: 0, g: 128, b: 128, a: 1&#125;,</span><br><span class="line">    thistle: &#123;r: 216, g: 191, b: 216, a: 1&#125;,</span><br><span class="line">    tomato: &#123;r: 255, g: 99, b: 71, a: 1&#125;,</span><br><span class="line">    turquoise: &#123;r: 64, g: 224, b: 208, a: 1&#125;,</span><br><span class="line">    violet: &#123;r: 238, g: 130, b: 238, a: 1&#125;,</span><br><span class="line">    wheat: &#123;r: 245, g: 222, b: 179, a: 1&#125;,</span><br><span class="line">    white: &#123;r: 255, g: 255, b: 255, a: 1&#125;,</span><br><span class="line">    whitesmoke: &#123;r: 245, g: 245, b: 245, a: 1&#125;,</span><br><span class="line">    yellow: &#123;r: 255, g: 255, b: 0, a: 1&#125;,</span><br><span class="line">    yellowgreen: &#123;r: 154, g: 205, b: 50, a: 1&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function tagcloudHelper(tags, options) &#123;</span><br><span class="line">    if (!options &amp;&amp; (!tags || !tags.hasOwnProperty(&apos;length&apos;))) &#123;</span><br><span class="line">        options = tags;</span><br><span class="line">        tags = this.site.tags;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!tags || !tags.length) return &apos;&apos;;</span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    var min = options.min_font || 10;</span><br><span class="line">    var max = options.max_font || 20;</span><br><span class="line">    var orderby = options.orderby || &apos;name&apos;;</span><br><span class="line">    var order = options.order || 1;</span><br><span class="line">    var unit = options.unit || &apos;px&apos;;</span><br><span class="line">    var color = options.color;</span><br><span class="line">    var transform = options.transform;</span><br><span class="line">    var separator = options.separator || &apos; &apos;;</span><br><span class="line">    var result = [];</span><br><span class="line">    var self = this;</span><br><span class="line">    var startColor, endColor;</span><br><span class="line"></span><br><span class="line">    if (color) &#123;</span><br><span class="line">        startColor = new Color(options.start_color);</span><br><span class="line">        endColor = new Color(options.end_color);</span><br><span class="line"></span><br><span class="line">        if (!startColor || !endColor) color = false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Sort the tags</span><br><span class="line">    if (orderby === &apos;random&apos; || orderby === &apos;rand&apos;) &#123;</span><br><span class="line">        tags = tags.random();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        tags = tags.sort(orderby, order);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Ignore tags with zero posts</span><br><span class="line">    tags = tags.filter(function(tag) &#123;</span><br><span class="line">        return tag.length;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // Limit the number of tags</span><br><span class="line">    if (options.amount) &#123;</span><br><span class="line">        tags = tags.limit(options.amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var sizes = [];</span><br><span class="line"></span><br><span class="line">    tags.sort(&apos;length&apos;).forEach(function(tag) &#123;</span><br><span class="line">        var length = tag.length;</span><br><span class="line">        if (~sizes.indexOf(length)) return;</span><br><span class="line"></span><br><span class="line">        sizes.push(length);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    var length = sizes.length - 1;</span><br><span class="line"></span><br><span class="line">    tags.forEach(function(tag) &#123;</span><br><span class="line">        var ratio = length ? sizes.indexOf(tag.length) / length : 0;</span><br><span class="line">        var size = min + ((max - min) * ratio);</span><br><span class="line">        var style = &apos;font-size: &apos; + parseFloat(size.toFixed(2)) + unit + &apos;;&apos;;</span><br><span class="line"></span><br><span class="line">        if (color) &#123;</span><br><span class="line">            var midColor = startColor.mix(endColor, ratio);</span><br><span class="line">            style += &apos; color: &apos; + midColor.toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result.push(</span><br><span class="line">            // 增加/index.html  跳转地址   </span><br><span class="line">            &apos;&lt;a href=&quot;&apos; + self.url_for(tag.path) + &apos;index.html&quot; style=&quot;&apos; + style + &apos;&quot;&gt;&apos; +</span><br><span class="line">            (transform ? transform(tag.name) : tag.name) +</span><br><span class="line">            &apos;&lt;/a&gt;&apos;</span><br><span class="line">        );</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return result.join(separator);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Color(color) &#123;</span><br><span class="line">    if (typeof color === &apos;object&apos;) &#123;</span><br><span class="line">        this.r = color.r;</span><br><span class="line">        this.g = color.g;</span><br><span class="line">        this.b = color.b;</span><br><span class="line">        this.a = color.a;</span><br><span class="line">    &#125; else if (typeof color === &apos;string&apos;) &#123;</span><br><span class="line">        this.parse(color);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        throw new TypeError(&apos;color is required!&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (this.r &lt; 0 || this.r &gt; 255 ||</span><br><span class="line">        this.g &lt; 0 || this.g &gt; 255 ||</span><br><span class="line">        this.b &lt; 0 || this.b &gt; 255 ||</span><br><span class="line">        this.a &lt; 0 || this.a &gt; 1) &#123;</span><br><span class="line">        throw new Error(color + &apos; is invalid.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Color.prototype.parse = function(color) &#123;</span><br><span class="line">    color = color.toLowerCase();</span><br><span class="line"></span><br><span class="line">    if (colorNames.hasOwnProperty(color)) &#123;</span><br><span class="line">        var obj = colorNames[color];</span><br><span class="line"></span><br><span class="line">        this.r = obj.r;</span><br><span class="line">        this.g = obj.g;</span><br><span class="line">        this.b = obj.b;</span><br><span class="line">        this.a = obj.a;</span><br><span class="line"></span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var match, txt, code;</span><br><span class="line"></span><br><span class="line">    if (rHex3.test(color)) &#123;</span><br><span class="line">        txt = color.substring(1);</span><br><span class="line">        code = parseInt(txt, 16);</span><br><span class="line"></span><br><span class="line">        this.r = ((code &amp; 0xF00) &gt;&gt; 8) * 17;</span><br><span class="line">        this.g = ((code &amp; 0xF0) &gt;&gt; 4) * 17;</span><br><span class="line">        this.b = (code &amp; 0xF) * 17;</span><br><span class="line">        this.a = 1;</span><br><span class="line">    &#125; else if (rHex6.test(color)) &#123;</span><br><span class="line">        txt = color.substring(1);</span><br><span class="line">        code = parseInt(txt, 16);</span><br><span class="line"></span><br><span class="line">        this.r = (code &amp; 0xFF0000) &gt;&gt; 16;</span><br><span class="line">        this.g = (code &amp; 0xFF00) &gt;&gt; 8;</span><br><span class="line">        this.b = code &amp; 0xFF;</span><br><span class="line">        this.a = 1;</span><br><span class="line">    &#125; else if (rRGB.test(color)) &#123;</span><br><span class="line">        match = color.match(rRGB);</span><br><span class="line"></span><br><span class="line">        this.r = match[1] | 0;</span><br><span class="line">        this.g = match[2] | 0;</span><br><span class="line">        this.b = match[3] | 0;</span><br><span class="line">        this.a = match[4] ? +match[4] : 1;</span><br><span class="line">    &#125; else if (rHSL.test(color)) &#123;</span><br><span class="line">        match = color.match(rHSL);</span><br><span class="line"></span><br><span class="line">        var h = +match[1] / 360;</span><br><span class="line">        var s = +match[2] / 100;</span><br><span class="line">        var l = +match[3] / 100;</span><br><span class="line"></span><br><span class="line">        this.a = match[4] ? +match[4] : 1;</span><br><span class="line"></span><br><span class="line">        if (!s) &#123;</span><br><span class="line">            this.r = this.g = this.b = l * 255;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var q = l &lt; 0.5 ? l * (1 + s) : l + s - (l * s);</span><br><span class="line">        var p = (2 * l) - q;</span><br><span class="line"></span><br><span class="line">        var rt = h + (1 / 3);</span><br><span class="line">        var gt = h;</span><br><span class="line">        var bt = h - (1 / 3);</span><br><span class="line"></span><br><span class="line">        this.r = convertHue(p, q, rt);</span><br><span class="line">        this.g = convertHue(p, q, gt);</span><br><span class="line">        this.b = convertHue(p, q, bt);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        throw new Error(color + &apos; is not a supported color format.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Color.prototype.toString = function() &#123;</span><br><span class="line">    if (this.a === 1) &#123;</span><br><span class="line">        var r = convertRGB(this.r);</span><br><span class="line">        var g = convertRGB(this.g);</span><br><span class="line">        var b = convertRGB(this.b);</span><br><span class="line"></span><br><span class="line">        if (this.r % 17 || this.g % 17 || this.b % 17) &#123;</span><br><span class="line">            return &apos;#&apos; + r + g + b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return &apos;#&apos; + r[0] + g[0] + b[0];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return &apos;rgba(&apos; + this.r + &apos;, &apos; + this.g + &apos;, &apos; + this.b + &apos;, &apos; + parseFloat(this.a.toFixed(2)) + &apos;)&apos;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Color.prototype.mix = function(color, ratio) &#123;</span><br><span class="line">    switch (ratio) &#123;</span><br><span class="line">        case 0:</span><br><span class="line">            return new Color(this);</span><br><span class="line"></span><br><span class="line">        case 1:</span><br><span class="line">            return new Color(color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return new Color(&#123;</span><br><span class="line">        r: Math.round(mixValue(this.r, color.r, ratio)),</span><br><span class="line">        g: Math.round(mixValue(this.g, color.g, ratio)),</span><br><span class="line">        b: Math.round(mixValue(this.b, color.b, ratio)),</span><br><span class="line">        a: mixValue(this.a, color.a, ratio)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function convertHue(p, q, h) &#123;</span><br><span class="line">    if (h &lt; 0) h++;</span><br><span class="line">    if (h &gt; 1) h--;</span><br><span class="line"></span><br><span class="line">    var color;</span><br><span class="line"></span><br><span class="line">    if (h * 6 &lt; 1) &#123;</span><br><span class="line">        color = p + ((q - p) * h * 6);</span><br><span class="line">    &#125; else if (h * 2 &lt; 1) &#123;</span><br><span class="line">        color = q;</span><br><span class="line">    &#125; else if (h * 3 &lt; 2) &#123;</span><br><span class="line">        color = p + ((q - p) * ((2 / 3) - h) * 6);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        color = p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return Math.round(color * 255);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function convertRGB(value) &#123;</span><br><span class="line">    var str = value.toString(16);</span><br><span class="line">    if (value &lt; 16) return &apos;0&apos; + str;</span><br><span class="line"></span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function mixValue(a, b, ratio) &#123;</span><br><span class="line">    return a + ((b - a) * ratio);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = tagcloudHelper;</span><br></pre></td></tr></table></figure><p></p>
<p>参考地址: <a href="https://github.com/xuxianyu/ming/tree/master/hexo" target="_blank" rel="noopener">https://github.com/xuxianyu/ming/tree/master/hexo</a> </p>
<p>实例地址: <a href="https://www.xujiuming.com">https://www.xujiuming.com</a>  本网站就是采用这种方法实现的</p>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/cdn/" rel="tag"># cdn</a>
          
            <a href="/tags/oss/" rel="tag"># oss</a>
          
            <a href="/tags/http-https/" rel="tag"># http/https</a>
          
            <a href="/tags/阿里云/" rel="tag"># 阿里云</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ming/a365393a.html" rel="next" title="idea 常用插件">
                <i class="fa fa-chevron-left"></i> idea 常用插件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/ming/4732d3fc.html" rel="prev" title="基于jenkins2.X和docker的持续集成的实例">
                基于jenkins2.X和docker的持续集成的实例 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ming</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/index.html">
              
                  <span class="site-state-item-count">94</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">66</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ming</span>

  
</div>


  <div class="powered-by"> github地址： <a class="theme-link" target="_blank" href="https://github.com/xuxianyu">ming git hub </a> </div>



  <span class="post-meta-divider">|</span>



  <div class="powered-by">博客 <a class="theme-link" target="_blank" href="https://www.xujiuming.com">ming</a> </div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  








    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    


    
      <style>a.gitment-editor-footer-tip{display:none}.gitment-container.gitment-footer-container{display:none}</style>
    

    
      <script type="text/javascript">function renderGitment(){new Gitmint({id:window.location.pathname,owner:"xuxianyu",repo:"xuxianyu.github.io",lang:navigator.language||navigator.systemLanguage||navigator.userLanguage,oauth:{client_secret:"c7bde53a4db53ddaf81d41927b5fa1bcf9eee90b",client_id:"300e508de764bc6155a6"}}).render("gitment-container")}renderGitment()</script>
    





<script type="text/javascript">$(".gitment-comments-init-btn").trigger("click")</script>




  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script></body></html>